# REST API SSO (Single Sign-On) Руководство

Этот README предоставляет обзор проекта REST API SSO (Single Sign-On). Этот проект предназначен для обработки аутентификации и авторизации пользователей для различных сервисов через централизованную систему аутентификации с использованием JWT (JSON Web Tokens). Он состоит из трех конечных точек:

## Конечные точки

### 1. GET /login
- **Описание**: Эта конечная точка используется для аутентификации пользователей. Она принимает логин и пароль из тела HTTP-запроса и проверяет их наличие в базе данных. Если пользователь существует, то возвращается JWT-токен.
- **Параметры запроса**:
  - `login` (строка): Логин пользователя.
  - `password` (строка): Пароль пользователя.
- **Ответы**:
  - `200 OK`: В случае успешной аутентификации возвращает JWT-токен.
  - `401 Unauthorized`: В случае неправильных учетных данных возвращает сообщение об ошибке.

### 2. GET /auth
- **Описание**: Эта конечная точка используется для проверки авторизации пользователя и его доступа к сервису. Она принимает JWT-токен и идентификатор сервиса в заголовке запроса и проверяет, находится ли токен в черном списке и не истек ли он. Если токен в порядке, возвращаются данные о пользователе, если он имеет доступ к сервису.
- **Параметры запроса**:
  - `jwt` (заголовок): JWT-токен пользователя.
  - `serviceid` (заголовок): Идентификатор сервиса, к которому пользователь хочет получить доступ.
- **Ответы**:
  - `200 OK`: В случае успешной проверки возвращает данные о пользователе, если у него есть доступ к сервису.
  - `401 Unauthorized`: В случае ошибки возвращает сообщение об ошибке.

### 3. POST /logout
- **Описание**: Эта конечная точка используется для выхода пользователя из системы. Она принимает JWT-токен в заголовке запроса и добавляет его в черный список. Если токен добавлен в черный список, то /auth его не примет и вернет ошибку.
- **Параметры запроса**:
  - `jwt` (заголовок): JWT-токен пользователя для выхода.
- **Ответы**:
  - `200 OK`: В случае успешного выхода пользователя из системы.
  - `401 Unauthorized`: В случае ошибки возвращает сообщение об ошибке.

## Запуск

Для запуска проекта выполните следующую команду с использованием Docker Compose:

```bash
docker-compose up --build server
``` 

# Примеры запросов 

**1. Вход (Login):**
Для выполнения входа в систему, используйте следующую команду cURL:
```bash
curl --location --request GET 'localhost:3001/login' \
--header 'Content-Type: text/plain' \
--data-raw '{
    "email" : "pav@mm.ru",
    "password" : "pawpaw123"
}
```




**2. Аутентификация (Authentication):**
Для выполнения аутентификации с использованием JWT-токена, выполните следующую команду cURL:

```bash
curl --location 'localhost:3001/auth' \
--header 'jwt: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VyZGF0YSI6eyJJZCI6IjIiLCJQYXRyb255bWljIjoi0J_QtdGC0YDQvtCyIiwiRmlyc3ROYW1lIjoi0JDQu9C10LrRgdC10LkiLCJMYXN0TmFtZSI6ItCS0LvQsNC00LjQvNC40YDQvtCy0LjRhyIsIkVtYWlsIjoicGF2QG1tLnJ1In0sIlNlcnZpY2VzIjpbMV0sImV4cCI6MTY5NjUxODc4NH0.1MV01GBey33ccjXkMRLnbVlXUfP_sJsBwk0ACXeLAVs' \
--header 'serviceid: 1'
```


**3. Выход (Logout):**
Для выхода из системы, используйте следующую команду cURL:

```bash
curl --location --request POST 'localhost:3001/logout' \
--header 'jwt: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VyZGF0YSI6eyJJZCI6IjIiLCJQYXRyb255bWljIjoi0J_QtdGC0YDQvtCyIiwiRmlyc3ROYW1lIjoi0JDQu9C10LrRgdC10LkiLCJMYXN0TmFtZSI6ItCS0LvQsNC00LjQvNC40YDQvtCy0LjRhyIsIkVtYWlsIjoicGF2QG1tLnJ1In0sIlNlcnZpY2VzIjpbMV0sImV4cCI6MTA4MDAwMDAwMDAwMDB9.q9HRKTSiyxpGqGHm-dY4mcOUv6YAUttgHfRWfjTS93g'
```


# Заметки по проекту REST API SSO

В этом разделе представлены заметки и рекомендации по улучшению проекта REST API SSO.

1. **Декомпозиция кода в `api.go`**: Нужно рассмотреть возможность разделения кода в файле `api.go`, выделив функционал связанный с JWT в отдельный пакет. Это улучшит читаемость кода и упростит его поддержку.

2. **Тестирование**: Для обеспечения надежности и корректности работы API, нужно написать тесты

3. **Проблема с подключением к PostgreSQL**: При запуске контейнеров сервер может делать рестарт, пока не установит успешное соединение с PostgreSQL. 

4. **ХАРДКОД**: Многие параметры в проекте захардкожены. В реальном, конечно, лучше так не делать. 
